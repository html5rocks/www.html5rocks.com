window.tuts={feed:undefined,feeddfr:$.Deferred(),authors:undefined,tmpl:undefined,classToTag:{offline:["appcache"],storage:["indexeddb"],connectivity:["xhr2","websockets"],file_access:["filesystem","file","quota"],semantics:[],multimedia:["webaudio","video","media source"],graphics:["webgl","3d"],presentation:["css","css3"],performance:["workers"],nuts_and_bolts:["devtools"],},init:function(){$("#filter a").click(clearFilter);var b=$.ajax({url:"/api/authors",dataType:"json",localCache:true,success:function(c){tuts.authors=c}});var a=$.ajax({url:"/static/js/tutstmpl.html",dataType:"text",localCache:true,success:function(c){tuts.tmpl=Handlebars.compile(c)}});$.when(tuts.feeddfr.promise(),b,a).done(tuts.compile)},compile:function(){tuts.normalize();var a=tuts.tmpl({updates:tuts.feed.entries});$("#index").append(a);tuts.resort()},normalize:function(){tuts.feed.entries=tuts.feed.entries.map(function(g){if(g.author=="ebidelman"){g.author="ericbidelman"}var c=tuts.authors[g.author];g.fullname=c.given_name+" "+c.family_name;var b=["January","February","March","April","May","June","July","August","September","October","November","December"];var d=new Date(g.publishedDate);g.date=d.toJSON().split("T")[0];g.formattedDateStr=b[d.getMonth()].slice(0,3)+". "+d.getDate()+", "+d.getFullYear();g.categories=g.categories.map(function(i){return i.replace(/,/g,"").trim()});g.tags=g.categories.join(", ");var h={};g.classes=[];for(var f=0,a=g.categories.length;cat=g.categories[f],f<a;f++){for(var e in tuts.classToTag){if(e==cat){g.categories.splice(f,1);h[e]=true}}}g.classes=Object.keys(h);return g})},resort:function(){var a=$(".tutorial_listing");a=a.each(function(c,d){var b=new Date(d.getAttribute("data-pubdate"));$.data(d,"date",b)}).get().sort(function(d,c){return $.data(d,"date")>$.data(c,"date")?-1:1});$(a).appendTo("#index");initPage()}};function clearFilter(){$(".tutorial_listing.hidden").removeClass("hidden");$("#updates_tag_filter").val("");$('section.filter input[type="checkbox"]').attr("checked",false);$("#filter").parent().addClass("hidden");if(!!window.history){var a=document.documentElement.lang||"en";history.replaceState({},document.title,"/"+a+"/tutorials/")}else{window.location.hash=""}return false}function initializeFilters(b){var c=[];b.toLowerCase().split(",").forEach(function(d,e){var f=d.split(":");if(f.length==2){var g=' input[value="'+f[1]+'"]';switch(f[0]){case"type":$("#updates_format_filter"+g).attr("checked",true);break;case"audience":$("#updates_audience_filter"+g).attr("checked",true);break;case"technology":$("#updates_technology_filter"+g).attr("checked",true);break;default:break}}else{c.push(f[0])}});if(c.length){var a=$("#updates_tag_filter")[0];if(a.value){a.value+=","}a.value+=c.join(",")}}var times=0;function filterTag(o){var h=window.event;console.log("called: "+ ++times);var m=$(".tutorial_listing");m.addClass("hidden");if(o&&typeof(o)=="string"&&o.length){initializeFilters(o)}var l=[];var g=[];$('#updates_format_filter input[type="checkbox"]:checked').each(function(e,j){g.push(j.value);l.push("type:"+j.value)});var f=[];$('#updates_audience_filter input[type="checkbox"]:checked').each(function(e,j){f.push(j.value);l.push("audience:"+j.value)});var n=[];$('#updates_technology_filter input[type="checkbox"]:checked').each(function(e,j){n.push(j.value);l.push("technology:"+j.value)});var s=$("#updates_tag_filter")[0].value;var k;if(s){k=s.toLowerCase().split(",");l.push(s)}else{k=[]}for(var d=0;d<m.length;d++){var b=true;var p=m[d];if((g.length>0)&&(g.indexOf(p.dataset.type)<0)){b=false}if(b&&(f.length>0)){var a=false;for(var c=0;c<f.length;c++){if($('span.tag:contains("'+f[c]+'")',p).length>0){a=true;break}}b=a}if(b&&(n.length>0)){var a=false;var r=p.dataset.classes.split(",");for(var c=0;c<n.length;c++){if(r.indexOf(n[c])>=0){a=true;break}}b=a}if(b&&(s)){var a=false;for(var c=0;c<k.length;c++){if((k[c].length>0)&&$('span.tag:contains("'+k[c]+'")',p).length>0){a=true;break}}b=a}if(b){p.classList.remove("hidden")}}if(l.length){var q=l.join(",");if(Modernizr.history){window.history.pushState(null,document.title,[window.location.pathname,"#",q].join(""))}$("#filter_tag").text(q);$("#filter").parent().removeClass("hidden")}else{$("#filter_tag").text("");$("#filter").parent().addClass("hidden")}}function initPage(){$(".tag").live("click",function(a){filterTag(this.textContent)});$('section.filter input[type="checkbox"]').click(filterTag);if(window.location.hash){filterTag(window.location.hash.substring(1))}}tuts.init();